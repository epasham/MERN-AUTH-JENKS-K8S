var TYPE = require('../../tokenizer').TYPE;
<<<<<<< HEAD
var rawMode = require('./Raw').mode;
=======
>>>>>>> e547b3e77583be3c8de92b6c78317e2fb285a75a

var LEFTCURLYBRACKET = TYPE.LeftCurlyBracket;

function consumeRaw(startToken) {
<<<<<<< HEAD
    return this.Raw(startToken, rawMode.leftCurlyBracket, true);
=======
    return this.Raw(startToken, LEFTCURLYBRACKET, 0, false, true);
>>>>>>> e547b3e77583be3c8de92b6c78317e2fb285a75a
}

function consumePrelude() {
    var prelude = this.SelectorList();

    if (prelude.type !== 'Raw' &&
        this.scanner.eof === false &&
        this.scanner.tokenType !== LEFTCURLYBRACKET) {
<<<<<<< HEAD
        this.error();
=======
        this.scanner.error();
>>>>>>> e547b3e77583be3c8de92b6c78317e2fb285a75a
    }

    return prelude;
}

module.exports = {
    name: 'Rule',
    structure: {
        prelude: ['SelectorList', 'Raw'],
        block: ['Block']
    },
    parse: function() {
<<<<<<< HEAD
        var startToken = this.scanner.tokenIndex;
=======
        var startToken = this.scanner.currentToken;
>>>>>>> e547b3e77583be3c8de92b6c78317e2fb285a75a
        var startOffset = this.scanner.tokenStart;
        var prelude;
        var block;

        if (this.parseRulePrelude) {
            prelude = this.parseWithFallback(consumePrelude, consumeRaw);
        } else {
            prelude = consumeRaw.call(this, startToken);
        }

        block = this.Block(true);

        return {
            type: 'Rule',
            loc: this.getLocation(startOffset, this.scanner.tokenStart),
            prelude: prelude,
            block: block
        };
    },
    generate: function(node) {
        this.node(node.prelude);
        this.node(node.block);
    },
    walkContext: 'rule'
};
