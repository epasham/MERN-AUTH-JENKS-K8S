var TYPE = require('../../tokenizer').TYPE;
<<<<<<< HEAD
var rawMode = require('./Raw').mode;
=======
>>>>>>> e547b3e77583be3c8de92b6c78317e2fb285a75a

var WHITESPACE = TYPE.WhiteSpace;
var COMMENT = TYPE.Comment;
var SEMICOLON = TYPE.Semicolon;
<<<<<<< HEAD
var ATKEYWORD = TYPE.AtKeyword;
=======
var ATRULE = TYPE.Atrule;
>>>>>>> e547b3e77583be3c8de92b6c78317e2fb285a75a
var LEFTCURLYBRACKET = TYPE.LeftCurlyBracket;
var RIGHTCURLYBRACKET = TYPE.RightCurlyBracket;

function consumeRaw(startToken) {
<<<<<<< HEAD
    return this.Raw(startToken, null, true);
=======
    return this.Raw(startToken, 0, 0, false, true);
>>>>>>> e547b3e77583be3c8de92b6c78317e2fb285a75a
}
function consumeRule() {
    return this.parseWithFallback(this.Rule, consumeRaw);
}
function consumeRawDeclaration(startToken) {
<<<<<<< HEAD
    return this.Raw(startToken, rawMode.semicolonIncluded, true);
}
function consumeDeclaration() {
    if (this.scanner.tokenType === SEMICOLON) {
        return consumeRawDeclaration.call(this, this.scanner.tokenIndex);
=======
    return this.Raw(startToken, 0, SEMICOLON, true, true);
}
function consumeDeclaration() {
    if (this.scanner.tokenType === SEMICOLON) {
        return consumeRawDeclaration.call(this, this.scanner.currentToken);
>>>>>>> e547b3e77583be3c8de92b6c78317e2fb285a75a
    }

    var node = this.parseWithFallback(this.Declaration, consumeRawDeclaration);

    if (this.scanner.tokenType === SEMICOLON) {
        this.scanner.next();
    }

    return node;
}

module.exports = {
    name: 'Block',
    structure: {
        children: [[
            'Atrule',
            'Rule',
            'Declaration'
        ]]
    },
    parse: function(isDeclaration) {
        var consumer = isDeclaration ? consumeDeclaration : consumeRule;

        var start = this.scanner.tokenStart;
        var children = this.createList();

<<<<<<< HEAD
        this.eat(LEFTCURLYBRACKET);
=======
        this.scanner.eat(LEFTCURLYBRACKET);
>>>>>>> e547b3e77583be3c8de92b6c78317e2fb285a75a

        scan:
        while (!this.scanner.eof) {
            switch (this.scanner.tokenType) {
                case RIGHTCURLYBRACKET:
                    break scan;

                case WHITESPACE:
                case COMMENT:
                    this.scanner.next();
                    break;

<<<<<<< HEAD
                case ATKEYWORD:
=======
                case ATRULE:
>>>>>>> e547b3e77583be3c8de92b6c78317e2fb285a75a
                    children.push(this.parseWithFallback(this.Atrule, consumeRaw));
                    break;

                default:
                    children.push(consumer.call(this));
            }
        }

        if (!this.scanner.eof) {
<<<<<<< HEAD
            this.eat(RIGHTCURLYBRACKET);
=======
            this.scanner.eat(RIGHTCURLYBRACKET);
>>>>>>> e547b3e77583be3c8de92b6c78317e2fb285a75a
        }

        return {
            type: 'Block',
            loc: this.getLocation(start, this.scanner.tokenStart),
            children: children
        };
    },
    generate: function(node) {
        this.chunk('{');
        this.children(node, function(prev) {
            if (prev.type === 'Declaration') {
                this.chunk(';');
            }
        });
        this.chunk('}');
    },
    walkContext: 'block'
};
